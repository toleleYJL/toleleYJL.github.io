<!DOCTYPE html><html lang="zh-CN"><head><title>æ’æ¡©æŠ€æœ¯åŠPinå·¥å…·</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
}</script><div><div class="inner"><h1>æ’æ¡©æŠ€æœ¯åŠPinå·¥å…·</h1><div class="time">2023-03-03</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00%EF%BC%9A%E6%8F%92%E6%A1%A9%E6%8A%80%E6%9C%AF"><span class="toc-text">0x00ï¼šæ’æ¡©æŠ€æœ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01%EF%BC%9APin%E5%B7%A5%E5%85%B7%EF%BC%9A"><span class="toc-text">0x01ï¼šPinå·¥å…·ï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02%EF%BC%9APin-In-CTF"><span class="toc-text">0x02ï¼šPin-In-CTF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03%EF%BC%9A%E5%8F%82%E8%80%83"><span class="toc-text">0x03ï¼šå‚è€ƒ</span></a></li></ol><h2 id="0x00ï¼šæ’æ¡©æŠ€æœ¯"><a href="#0x00ï¼šæ’æ¡©æŠ€æœ¯" class="headerlink" title="0x00ï¼šæ’æ¡©æŠ€æœ¯"></a>0x00ï¼šæ’æ¡©æŠ€æœ¯</h2><div style="font-size: 21px;"><b>ä½•ä¸ºæ’æ¡©ï¼Ÿ</b></div>

<p><strong>æ’æ¡© ( Instrumentation ) <strong>æ˜¯ä¸€ç§æµ‹è¯•ç¨‹åºæ€§èƒ½ã€æ£€æµ‹é”™è¯¯å’Œè·å–ç¨‹åºæ‰§è¡Œä¿¡æ¯çš„æŠ€æœ¯ã€‚åœ¨ä¿è¯è¢«æµ‹ç¨‹åºåŸæœ‰é€»è¾‘å®Œæ•´æ€§çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åœ¨ç¨‹åºä¸­æ’å…¥ä¸€äº›</strong>æ¢é’ˆ(probe)ï¼Œ</strong>å³æ·»åŠ ä¸€äº›ä»£ç ï¼Œè·å¾—ç¨‹åºçš„æ§åˆ¶æµå’Œæ•°æ®æµä¿¡æ¯ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°ï¼šé€šè¿‡æ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨åŒ–å·¥å…·ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå‰å’Œååˆ†åˆ«æ’å…¥è¯»å–è®¡æ—¶å™¨çš„ä»£ç ï¼Œä¾¿å¯è·å–å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚</p>
<br>

<div style="font-size: 21px;"><b>æ’æ¡©åˆ†ç±»ï¼š</b></div>

<ul>
<li>æ ¹æ®<strong>æ’æ¡©å¯¹è±¡</strong>ä¸åŒï¼Œåˆ†ä¸ºæºä»£ç æ’æ¡©å’ŒäºŒè¿›åˆ¶æ’æ¡©ï¼›</li>
<li>æ ¹æ®<strong>æ’æ¡©ç²’åº¦</strong>ä¸åŒï¼Œåˆ†ä¸ºæŒ‡ä»¤çº§åˆ«æ’æ¡©ã€å‡½æ•°çº§åˆ«æ’æ¡©ã€åŸºæœ¬å—çº§åˆ«æ’æ¡©ã€è¾¹ç•Œçº§åˆ«æ’æ¡©ï¼›</li>
<li>æ ¹æ®<strong>åˆ†ææ–¹æ³•</strong>ä¸åŒï¼Œåˆ†ä¸ºé™æ€æ’æ¡©å’ŒåŠ¨æ€æ’æ¡©ï¼›</li>
</ul>
<br>

<p><strong>å¸¸è§çš„åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶å¹³å°ï¼š</strong>Pinã€DynamoRIOå’ŒFridaã€‚</p>
<p>ä¸‹é¢ä¼šå¯¹Pinå·¥å…·è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚</p>
<br>

<h2 id="0x01ï¼šPinå·¥å…·ï¼š"><a href="#0x01ï¼šPinå·¥å…·ï¼š" class="headerlink" title="0x01ï¼šPinå·¥å…·ï¼š"></a>0x01ï¼šPinå·¥å…·ï¼š</h2><p>Pin æ˜¯ Intel å…¬å¸ç ”å‘çš„ä¸€ä¸ªåŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æ¡†æ¶ï¼Œé€šè¿‡è¯¥æ¶æ„å¯ä»¥åœ¨äºŒè¿›åˆ¶ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ’å…¥å„ç§å‡½æ•°ï¼Œä»¥ç›‘æ§ç¨‹åºæ¯ä¸€æ­¥çš„æ‰§è¡Œå’Œè·å–ç¨‹åºè¿è¡Œä¿¡æ¯ã€‚</p>
<p><strong>Pin å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ˜“ç”¨ï¼šä½¿ç”¨åŠ¨æ€æ’æ¡©ï¼Œä¸éœ€è¦æºä»£ç ã€ä¸éœ€è¦é‡æ–°ç¼–è¯‘å’Œé“¾æ¥ã€‚</li>
<li>å¯æ‰©å±•ï¼šæä¾›äº†ä¸°å¯Œçš„ APIï¼Œå¯ä»¥ä½¿ç”¨ C/C++ ç¼–å†™<code>æ’æ¡©å·¥å…·</code>ï¼ˆå³Pintoolï¼‰</li>
<li>å¤šå¹³å°ï¼š1ï¼‰æ”¯æŒ x86ã€x86-64ã€Itaniumã€Xscaleï¼›2ï¼‰Windowsã€Linuxã€OSXã€Android</li>
<li>é²æ£’æ€§ï¼š1ï¼‰æ”¯æŒæ’æ¡©ç°å®ä¸–ç•Œä¸­çš„åº”ç”¨ï¼šæ•°æ®åº“ã€æµè§ˆå™¨ç­‰ï¼›2ï¼‰æ”¯æŒæ’æ¡©å¤šçº¿ç¨‹åº”ç”¨ï¼›3ï¼‰æ”¯æŒä¿¡å·é‡ï¼›</li>
<li>é«˜æ•ˆï¼šåœ¨æŒ‡ä»¤ä»£ç å±‚é¢å®ç°ç¼–è¯‘ä¼˜åŒ–ï¼›</li>
</ul>
<br>

<p><strong>å››ç§æ’æ¡©ç²’åº¦ ( Instrumentation Granularity )ï¼š</strong></p>
<ul>
<li>æŒ‡ä»¤çº§æ’æ¡© ( Instruction instrumentation )</li>
<li>Trace instrumentationï¼šPin guarantees that a trace is only entered at the top, but it may contain multiple exits.</li>
<li>Image instrumentation</li>
<li>Routine instrumentation</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°äº†è¿™å››ç§æ’æ¡©ç²’åº¦ï¼ˆæ¨¡å¼ï¼‰ï¼Œè¿™é‡Œçœ‹å¾—æœ‰ç‚¹è¿·è¿·ç³Šç³Šï¼Œæ‰€ä»¥æƒ³è¦æ›´å¤šçš„äº†è§£ï¼Œå¯ä»¥å»æ–‡æ¡£ä¸­çœ‹çœ‹ã€‚</p>
<br>

<p><strong>Pinçš„æ•´ä½“æ¶æ„ï¼š</strong></p>
<p><img src="/images/%E6%8F%92%E6%A1%A9%E6%8A%80%E6%9C%AF%E5%8F%8APin%E5%B7%A5%E5%85%B7/5.2_pin_arch.png" alt="5.2_pin_arch"></p>
<p>ä»å›¾ä¸­çš„æ¶æ„å¯ä»¥çœ‹å‡ºï¼ŒPinå¯ä»¥åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼š</p>
<ul>
<li>Instrumentation APIsï¼šåœ¨ç¼–å†™Pintoolæ—¶ï¼Œä¾›Pintoolè°ƒç”¨çš„æ¥å£ï¼›</li>
<li>VMï¼šç”¨äºç¼–è¯‘å¹¶æ‰§è¡Œç¨‹åºã€‚å…¶ä¸­ï¼ŒJIT ç¼–è¯‘å™¨è´Ÿè´£å¯¹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æŒ‡ä»¤è¿›è¡Œæ’æ¡©å’Œç¼–è¯‘ï¼ŒEmulation Unit ç”¨æ¥å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼›</li>
<li>Code Cacheï¼šç”¨äºå­˜å‚¨ç»è¿‡VMç¼–è¯‘åçš„ä»£ç ï¼Œ Code Cacheä¸­çš„ä»£ç æ˜¯çœŸæ­£ç”¨äºæ‰§è¡Œçš„ï¼ŒåŸç›®æ ‡æ–‡ä»¶ä¸­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼›</li>
</ul>
<br>

<div style="font-size: 21px;"><b>åˆæ­¥ä½¿ç”¨ï¼š</b></div>

<p>é¦–å…ˆï¼Œä»<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/articles/tool/pin-a-dynamic-binary-instrumentation-tool.html">å®˜ç½‘</a>ä¸‹è½½Pinå·¥å…·å‹ç¼©åŒ…ã€‚</p>
<p>(<strong>æ³¨</strong>ï¼šå› ä¸ºåˆ¶ä½œPintooléœ€è¦ä½¿ç”¨makeå‘½ä»¤ï¼Œæ‰€ä»¥åœ¨Windowsç¯å¢ƒä¸‹ï¼Œéœ€è¦é…ç½®å¥½æ”¯æŒmakeçš„å·¥å…·ï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°çš„â€Gygwinâ€)</p>
<p>å‹ç¼©åŒ…è§£å‹åï¼Œå·¥å…·æ ¹ç›®å½•ä¸‹æœ‰ä¸ªåä¸º<code>pin</code>çš„å¯æ‰§è¡Œç¨‹åºï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥ç»“åˆPintoolè¿›è¡Œæ’æ¡©çš„ã€‚</p>
<p>Pintoolæ˜¯ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œåœ¨ä½¿ç”¨Pinæ—¶éœ€è¦é€šè¿‡å‚æ•°è½½å…¥Pintoolå¯¹é€‰å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ’æ¡©ã€‚</p>
<p>åœ¨<code>./source/tools/ManualExamples</code>ä¸­ï¼Œå®˜æ–¹æä¾›äº†å¾ˆå¤šçš„ç¤ºä¾‹ä»£ç ã€‚æºæ–‡ä»¶æ˜¯C++æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶makeï¼ˆç›¸å½“äºæ˜¯ç¼–è¯‘ï¼‰æˆ<code>.soæ–‡ä»¶</code>ï¼Œç„¶åä½¿ç”¨pinç¨‹åºç»“åˆ.soæ–‡ä»¶å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œæ’æ¡©æ“ä½œã€‚</p>
<pre><code class="Shell">############################
# Pintoolçš„åˆ¶ä½œ

# è·³è½¬åˆ°å¯¹åº”ç›®å½•
cd source/tools/ManualExamples

# å°†ManualExamplesç›®å½•ä¸‹çš„æ‰€æœ‰å·¥å…·æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘, ç„¶åæ”¾åˆ°obj-ia32ç›®å½•ä¸­
make all TARGET=ia32

# å°†ManualExamplesç›®å½•ä¸‹çš„æ‰€æœ‰å·¥å…·æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘, ç„¶åæ”¾åˆ°obj-intel64ç›®å½•ä¸­
make all TARGET=intel64

# å¯¹æŸä¸ªç‰¹å®šçš„ç¤ºä¾‹(inscount0.cpp)ç¼–è¯‘å¹¶æ‰§è¡Œ,ç›®æ ‡æ–‡ä»¶ä¸ºå®˜æ–¹é»˜è®¤æŒ‡å®šçš„
make inscount0.test TARGET=intel64

# å¯¹æŸä¸ªç‰¹å®šçš„ç¤ºä¾‹ç¼–è¯‘ï¼Œä½†ä¸æ‰§è¡Œ
make obj-intel64/inscount0.so TARGET=intel64

# å¯¹æŸä¸ªç‰¹å®šçš„ç¤ºä¾‹ç¼–è¯‘ï¼Œä½†ä¸æ‰§è¡Œ(IA-32æ¶æ„)
make obj-ia32/inscount0.so TARGET=ia32

# æ³¨:å…³äºia-32ä¸intel64çš„ä½¿ç”¨åŒºåˆ«äº†è§£ä¸å¤Ÿï¼Œä¸è¿‡è¦ä¸ç›®æ ‡ç¨‹åºçš„ä½æ•°å¯¹åº”

##################################
#ä½¿ç”¨pinç¨‹åºæ¥è¿›è¡Œæ’æ¡©æ“ä½œ

# å¯¹/bin/shè¿›è¡Œæ’æ¡©,æ‰§è¡Œåè·å–çš„ä¿¡æ¯é»˜è®¤å­˜æ”¾åœ¨inscount.out
../../../pin -t obj-intel64/inscount0.so -- /bin/ls

# -oå‚æ•°ç”¨äºæŒ‡å®šç»“æœå­˜æ”¾çš„ä½ç½®
../../../pin -t obj-intel64/inscount0.so -o inscount0.log -- /bin/ls
</code></pre>
<p>é€šè¿‡æµè§ˆ<code>incount0.cpp</code>ä»£ç ï¼Œå¯ä»¥å¤§æ¦‚äº†è§£çš„ç¼–å†™è§„åˆ™ã€‚</p>
<pre><code class="C">/*
 * Copyright (C) 2004-2021 Intel Corporation.
 * SPDX-License-Identifier: MIT
 */

#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &quot;pin.H&quot;
using std::cerr;
using std::endl;
using std::ios;
using std::ofstream;
using std::string;

ofstream OutFile;

// The running count of instructions is kept here
// make it static to help the compiler optimize docount
static UINT64 icount = 0;

// This function is called before every instruction is executed
VOID docount() &#123; icount++; &#125;

// Pin calls this function every time a new instruction is encountered
VOID Instruction(INS ins, VOID* v)
&#123;
    // Insert a call to docount before every instruction, no arguments are passed
    INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)docount, IARG_END);
&#125;

KNOB&lt; string &gt; KnobOutputFile(KNOB_MODE_WRITEONCE, &quot;pintool&quot;, &quot;o&quot;, &quot;inscount.out&quot;, &quot;specify output file name&quot;);

// This function is called when the application exits
VOID Fini(INT32 code, VOID* v)
&#123;
    // Write to a file since cout and cerr maybe closed by the application
    OutFile.setf(ios::showbase);
    OutFile &lt;&lt; &quot;Count &quot; &lt;&lt; icount &lt;&lt; endl;
    OutFile.close();
&#125;

// Print Help Message
INT32 Usage()  
&#123;
    cerr &lt;&lt; &quot;This tool counts the number of dynamic instructions executed&quot; &lt;&lt; endl;
    cerr &lt;&lt; endl &lt;&lt; KNOB_BASE::StringKnobSummary() &lt;&lt; endl;
    return -1;
&#125;

int main(int argc, char* argv[])
&#123;
    // Initialize pin
    if (PIN_Init(argc, argv)) return Usage();

    OutFile.open(KnobOutputFile.Value().c_str());

    // Register Instruction to be called to instrument instructions
    INS_AddInstrumentFunction(Instruction, 0);

    // Register Fini to be called when the application exits
    PIN_AddFiniFunction(Fini, 0);

    // Start the program, never returns
    PIN_StartProgram();

    return 0;
&#125;
</code></pre>
<p><code>PIN_Initå‡½æ•°</code>ï¼šç”¨äºåˆå§‹åŒ–ï¼Œå½“åœ¨è§£æå‘½ä»¤è¡Œæ—¶æ£€æµ‹åˆ°ä¸€ä¸ªé”™è¯¯åˆ™ä¼šè¿”å›trueï¼Œä»è€Œæ‰§è¡Œ<code>Usage()</code>æç¤ºå‘½ä»¤å‚æ•°ä¿¡æ¯ã€‚</p>
<p><code>PIN_StartProgramå‡½æ•°</code>ï¼šåœ¨JITæ¨¡å¼ä¸‹(é»˜è®¤å¤„äºè¯¥æ¨¡å¼)ï¼Œå¼€å§‹æ‰§è¡Œæ’æ¡©åçš„ç¨‹åºã€‚</p>
<p>ï¼ˆ<strong>æ³¨</strong>ï¼šPIN_Initå‡½æ•°å¿…é¡»å…ˆäºPIN_StartProgramå‡½æ•°è°ƒç”¨ï¼‰</p>
<p>INS_AddInstrumentFunctionã€TRACE_AddInstrumentFunctionã€IMG_AddInstrumentFunctionã€RTN_AddInstrumentFunctionå››ä¸ªå‡½æ•°åˆ†åˆ«å¯¹åº”ä¸Šé¢æåˆ°çš„å››ç§æ’æ¡©ç²’åº¦ã€‚</p>
<p>ç”±äºPinå·¥å…·æ˜¯ä¸å¼€æºçš„ï¼Œæ‰€ä»¥ä¹Ÿéš¾ä»¥æ›´åŠ æ·±å…¥çš„ç ”ç©¶ã€‚è‡³äºPintoolç¼–å†™è®¾è®¡åˆ°çš„å‡½æ•°ï¼Œæ²¡æœ‰å¿…è¦å»è®°ï¼Œç”¨åˆ°äº†å†å»å®˜æ–¹æ–‡æ¡£æŸ¥ã€‚æˆ‘ä»¬å¤§æ¦‚é€šè¿‡å®˜æ–¹ç»™çš„ç¤ºä¾‹çŸ¥é“Pinå·¥å…·èƒ½å¹²äº›ä»€ä¹ˆå°±è¡Œäº†ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ä¸€é“é¢˜æ¥è¯´è¯´Pinåœ¨CTFä¸­çš„åº”ç”¨ã€‚</p>
<br>

<h2 id="0x02ï¼šPin-In-CTF"><a href="#0x02ï¼šPin-In-CTF" class="headerlink" title="0x02ï¼šPin-In-CTF"></a>0x02ï¼šPin-In-CTF</h2><div style="font-size: 21px;"><b>NDH2k13-crackme-500</b></div>

<p>ï¼ˆæ³¨ï¼šæœ¬é¢˜æˆ‘ä¹Ÿä¸çŸ¥é“å¤§ä½¬ä»¬æ˜¯æ€ä¹ˆæƒ³åˆ°ç”¨Pinæ¥åšçš„ğŸ¤§ï¼Œä¸è¿‡æŠ›å¼€è§£é¢˜çš„ç›®çš„ï¼Œæ‹¿æ¥ç”¨äºç†Ÿæ‚‰Pinä¹Ÿæ˜¯ä¸é”™çš„ï¼‰</p>
<p>fileä¸€ä¸‹ï¼Œ64ä½çš„é™æ€ç¼–è¯‘ç¨‹åºï¼Œè¿è¡Œä¸€ä¸‹å‘ç°éœ€è¦è¾“å…¥å¯†ç ã€‚ç”±äºéªŒè¯å¯†ç çš„è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥å¯†ç çš„é•¿åº¦å’Œæ­£ç¡®ä¸å¦éƒ½ä¼šå¯¼è‡´æ‰§è¡Œçš„æŒ‡ä»¤æœ‰æ‰€ä¸åŒã€‚æ‰€ä»¥æ ¹æ®è¿™ä¸€ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡<code>æ‰§è¡ŒæŒ‡ä»¤çš„æ•°ç›®</code>æ¥å°è¯•è§£å‡ºå¯†ç ã€‚</p>
<p>æˆ‘å¯¹å®˜æ–¹ç»™çš„inscount0.cppè¿›è¡Œäº†ä¿®æ”¹ï¼Œä½¿å…¶æœ€ååœ¨ç»ˆç«¯è¾“å‡ºç»“æœï¼š</p>
<pre><code class="Shell">tolele@u22:~/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500 $ ../../../../pin -t ../obj-intel64/inscount_rr.so -- ./crackme
Jonathan Salwan loves you &lt;3
----------------------------

Password: a
Bad password
Count :161131
tolele@u22:~/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500 $ ../../../../pin -t ../obj-intel64/inscount_rr.so -- ./crackme
Jonathan Salwan loves you &lt;3
----------------------------

Password: aa
Bad password
Count :163927
tolele@u22:~/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500 $ ../../../../pin -t ../obj-intel64/inscount_rr.so -- ./crackme
Jonathan Salwan loves you &lt;3
----------------------------

Password: aaa
Bad password
Count :166723
</code></pre>
<p>å¯ä»¥å‘ç°éšç€è¾“å…¥å­—ç¬¦çš„é•¿åº¦å¢åŠ ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤æ•°é‡ä¹Ÿè¿›è¡Œä¸€å®šé‡å¢åŠ ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ­¤è¿›è¡Œçˆ†ç ´ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è·å¾—ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼š</p>
<pre><code class="Python">from pwn import *
last = 0
for length in range(1, 30):
    io = process(&#39;../../../../pin -t ../obj-intel64/inscount_rr.so -- ./crackme&#39;, shell=True)
    password = &#39;a&#39;*length
    io.recvuntil(&quot;Password: &quot;)
    io.sendline(password)
    io.recvuntil(&quot;Count :&quot;)
    inscount = io.recv(6)
    new = int(str(inscount)[2:-1], 10)
    change = new - last
    print(&quot;len=&quot;+str(length)+&quot;\tinscount=&quot;+str(new)+&quot;\t  change=&quot;+str(change))
    last = new
    io.close()
</code></pre>
<p>åœ¨çˆ†ç ´çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°process()å¼€å¯è¿›ç¨‹çš„æ˜¾ç¤ºä¿¡æ¯æœ‰äº›ç¢çœ¼ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨grepè¿›è¡Œäº†é™åˆ¶ï¼š</p>
<pre><code class="Shell">tolele@u22:~/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500 $ python3 GuessLen.py | grep len
/home/tolele/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500/GuessLen.py:6: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.recvuntil(&quot;Password: &quot;)
/home/tolele/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500/GuessLen.py:7: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.sendline(password)
/home/tolele/Tools/pin-3.26/source/tools/ManualExamples/NDH2k13-crackme-500/GuessLen.py:8: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  io.recvuntil(&quot;Count :&quot;)
len=1    inscount=161131   change=161131
len=2    inscount=163927   change=2796
len=3    inscount=166723   change=2796
len=4    inscount=169519   change=2796
len=5    inscount=172315   change=2796
len=6    inscount=175111   change=2796
len=7    inscount=177907   change=2796
len=8    inscount=183628   change=5721
len=9    inscount=183500   change=-128
len=10    inscount=186296   change=2796
len=11    inscount=189092   change=2796
len=12    inscount=191888   change=2796
len=13    inscount=194684   change=2796
len=14    inscount=197480   change=2796
len=15    inscount=200276   change=2796
len=16    inscount=203072   change=2796
len=17    inscount=205868   change=2796
len=18    inscount=208664   change=2796
len=19    inscount=211460   change=2796
len=20    inscount=214256   change=2796
len=21    inscount=217052   change=2796
len=22    inscount=219848   change=2796
len=23    inscount=222644   change=2796
len=24    inscount=225440   change=2796
len=25    inscount=228236   change=2796
len=26    inscount=231032   change=2796
len=27    inscount=245012   change=13980
len=28    inscount=245012   change=0
len=29    inscount=245012   change=0
</code></pre>
<p>çˆ†ç ´åå‘ç°é•¿åº¦ä¸º8æ—¶ï¼ŒæŒ‡ä»¤æ•°ç›®å¤§å¹…åº¦å¢åŠ ï¼Œæ‰€ä»¥å¯ä»¥å¤§èƒ†åœ°çŒœæµ‹å¯†ç é•¿åº¦ä¸º8ã€‚ï¼ˆå¯èƒ½æ˜¯ç¨‹åºå¯¹é•¿åº¦æœ‰ä¸€å®šçš„åˆ¤æ–­ï¼Œç¬¦åˆåæ‰è¿›è¡Œä¸‹ä¸€æ­¥çš„æ£€éªŒï¼‰</p>
<p>æ­¤å¤–ï¼Œè¿˜å‘ç°ï¼Œå½“æ¯è¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„å­—ç¬¦ï¼ŒæŒ‡ä»¤æ•°éƒ½æœ‰æ‰€å¢åŠ ã€‚æ¯”å¦‚ï¼Œæ­£ç¡®å¯†ç çš„ç¬¬ä¸€ä½æ˜¯â€™Aâ€™ï¼Œåˆ™<code>A2345678</code>æ˜¯æ¯”<code>12345678</code>æ‰€æ‰§è¡Œçš„æŒ‡ä»¤æ•°å¤šçš„ã€‚æ®æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¯†ç é€ä½è¿›è¡Œçˆ†ç ´ã€‚</p>
<pre><code class="Python">from pwn import *
import string

dic = string.ascii_letters + string.digits + &quot;+_&quot;
last = 0
dic_idx = 0
sure = &#39;&#39;

for i in range(8):
    for temp in dic:
        io = process(&#39;../../../../pin -t ../obj-intel64/inscount_rr.so -- ./crackme&#39;, shell=True)
        password = sure + temp + &#39;?&#39;*(8 - len(sure) -1)
        io.recvuntil(&quot;Password: &quot;)
        io.sendline(password)
        io.recvuntil(&quot;Count :&quot;)
        inscount = io.recv(6)
        new = int(str(inscount)[2:-1], 10)
        change = new - last
        print(&quot;pwd=&quot;+password+&quot;\t  inscount=&quot;+str(new)+&quot;\t  change=&quot;+str(change))
        last = new
        if change &gt; 2000 and change &lt; 10000:   # &lt;10000æ˜¯ä¸ºäº†é™¤å»ç¬¬ä¸€æ¬¡
            sure = sure + temp
            io.close()
            break
        io.close()
</code></pre>
<p>æ‰§è¡Œï¼š<code>python3 GuessPwd.py | grep pwd</code>ï¼Œæœ€åå¾—åˆ°<code>AzI0wBsX</code>ï¼Œå³å¯†ç ã€‚</p>
<pre><code class="shell">pwd=AzI0wBsP      inscount=211893     change=-1 
pwd=AzI0wBsQ      inscount=211893     change=0 
pwd=AzI0wBsR      inscount=211893     change=0 
pwd=AzI0wBsS      inscount=211893     change=0 
pwd=AzI0wBsT      inscount=211893     change=0 
pwd=AzI0wBsU      inscount=211893     change=0 
pwd=AzI0wBsV      inscount=211893     change=0 
pwd=AzI0wBsW      inscount=211893     change=0 
pwd=AzI0wBsX      inscount=215800     change=3907 
</code></pre>
<p>è¯¥é¢˜ç›®æ¥æºäºGitHubä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/bash-c/pin-in-CTF">pin-in-CTF</a>ï¼Œè¯¥é¡¹ç›®é‡Œé¢è¿˜åŒ…å«äº†å…¶å®ƒé¢˜ç›®ï¼Œä½†æ¶‰åŠåˆ°Pinå·¥å…·ä½¿ç”¨çš„å†…å®¹éƒ½å¤§å·®ä¸å·®ã€‚</p>
<br>

<h2 id="0x03ï¼šå‚è€ƒ"><a href="#0x03ï¼šå‚è€ƒ" class="headerlink" title="0x03ï¼šå‚è€ƒ"></a>0x03ï¼šå‚è€ƒ</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://software.intel.com/sites/landingpage/pintool/docs/98690/Pin/doc/html/index.html">https://software.intel.com/sites/landingpage/pintool/docs/98690/Pin/doc/html/index.html</a></p>
<p>CTF-All-In-Oneï¼š<a target="_blank" rel="noopener" href="https://www.bookstack.cn/read/CTF-All-In-One/doc-5.2.1_pin.md">https://www.bookstack.cn/read/CTF-All-In-One/doc-5.2.1_pin.md</a></p>
<p>ä¸€ç¯‡å¾ˆè¯¦ç»†çš„æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/T2777/article/details/121282703">https://blog.csdn.net/T2777/article/details/121282703</a></p>
<p>ç›¸å½“äºå®˜æ–¹æ–‡æ¡£çš„ä¸­æ–‡ç¿»è¯‘ï¼š<a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/167900.html">https://www.secpulse.com/archives/167900.html</a></p>
<p>pin-in-CTFï¼š<a target="_blank" rel="noopener" href="https://github.com/bash-c/pin-in-CTF">https://github.com/bash-c/pin-in-CTF</a></p>
<p class="textAlignRight"><span>â†¶ </span><a href="/">è¿”å›é¦–é¡µ</a><span></span></p></div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '');</script></html>